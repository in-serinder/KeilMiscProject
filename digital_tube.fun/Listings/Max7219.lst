C51 COMPILER V9.59.0.0   MAX7219                                                           06/30/2025 23:50:22 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAX7219
OBJECT MODULE PLACED IN .\Objects\Max7219.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Max7219.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\M
                    -ax7219.lst) TABS(2) OBJECT(.\Objects\Max7219.obj)

line level    source

   1          // #include <REG52.H>
   2          #include <Max7219.h>
   3          #include <Timer.h>
   4          
   5          // 修正：使用sbit定义位操作
   6          sbit MAX7219_CLK = P2 ^ 0;  // 时钟
   7          sbit MAX7219_DIN = P2 ^ 1;  // 数据输入
   8          sbit MAX7219_LOAD = P2 ^ 2; // 加载信号（片选）
   9          
  10          // 通过7219内部寄存器控制LED
  11          // Load处于低电平有效状态
  12          // 先将LOAD置高电平，再将数据写入7219，最后将LOAD置低电平 片选信号
  13          
  14          // 修正：删除函数声明，直接定义函数
  15          
  16          void Max7219_SendByte(unsigned char dat)
  17          {
  18   1          unsigned char i;
  19   1          for (i = 0; i < 8; i++) // 每个片选（管位）寄存器（每位一个8位二进制的数据）
  20   1          {
  21   2              MAX7219_CLK = 0;                    // 先将CLK置低电平
  22   2              MAX7219_DIN = (dat & 0x80) ? 1 : 0; // 先发送高位
  23   2              dat <<= 1;                          // 左移一位，将下一位放到最高位
  24   2              MAX7219_CLK = 1;                    // 再将CLK置高电平,一位数据发送完成
  25   2              Delay_us(1);                        // 延时，等待数据稳定
  26   2          }
  27   1      }
  28          
  29          void Max7219_Write(unsigned char address, unsigned char dat)
  30          {
  31   1          MAX7219_LOAD = 0; // 先将LOAD置低电平
  32   1          Max7219_SendByte(address);
  33   1          Max7219_SendByte(dat);
  34   1          MAX7219_LOAD = 1; // 完成传输
  35   1          Delay_us(1);
  36   1      }
  37          
  38          // 修正：删除多余参数，使用全局变量
  39          void Max7219_Init()
  40          {
  41   1      
  42   1          // 使用正确的函数名和参数
  43   1          Max7219_Write(0x0C, 0x01); // 退出休眠模式
  44   1          Max7219_Write(0x0F, 0x00); // 关闭测试模式
  45   1          Max7219_Write(0x0B, 0x07); // 设置扫描界限为8位（DIG0~DIG7）
  46   1          Max7219_Write(0x09, 0xFF); // 启用BCD译码（简化数字显示）
  47   1          Max7219_Write(0x0A, 0x08); // 设置亮度（0~15，8为中等亮度）
  48   1      }
  49          
  50          // 修正：添加括号确保正确的运算顺序
  51          void Max7219_Display(unsigned char digit, unsigned char value, unsigned char dot_v)
  52          {
  53   1          Max7219_Write(digit, value | (dot_v ? 0x80 : 0x00));
  54   1      }
C51 COMPILER V9.59.0.0   MAX7219                                                           06/30/2025 23:50:22 PAGE 2   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    119    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
