C51 COMPILER V9.59.0.0   MAIN                                                              09/10/2025 18:24:03 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Driver) DEBUG OBJECTEXTEND PRIN
                    -T(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <Ser.h>
   2          #include <Timer.h>
   3          #include <stdio.h>
   4          #include <Util.h>
   5          #include <LCD1602.h>
   6          
   7          /* ----串口消息格式----
   8           *时间戳: 2023-10-24-16:00:00^
   9           *继电器状态 000^
  10           *温湿度 00.00^00.00^
  11           *警告位 0^
  12           *日期更新位 0
  13           *完全格式 yyyy-mm-dd-tt:mm:ss^000^00.00^00.00^0^0
  14           */
  15          
  16          sbit Relay1 = P0 ^ 3;
  17          sbit Relay2 = P0 ^ 2;
  18          sbit Relay3 = P0 ^ 4;
  19          
  20          sbit RelayLED1 = P1 ^ 1;
  21          sbit RelayLED2 = P1 ^ 2;
  22          sbit RelayLED3 = P1 ^ 4;
  23          sbit WarnLed = P1 ^ 7;
  24          
  25          sbit infrared = P1 ^ 3;
  26          
  27          sbit RelayButton = P0 ^ 0;
  28          sbit SettingButton = P0 ^ 1;
  29          
  30          sbit BuzzerS1 = P0 ^ 0;
  31          
  32          void main()
  33          {
  34   1          char xdata *msg, *timestr;
  35   1          struct UtilOBJ xdata dat;
  36   1          unsigned int time;
  37   1          unsigned char i;
  38   1          unsigned char *IRdata;
  39   1          unsigned char xdata relaySetPos = 1, Timercount = 0;
  40   1          int xdata timecount = 0;
  41   1          bit dateOrTempFlag = 0;
  42   1          bit bitlogrelay = 0;
  43   1          bit settingflag = 0;
  44   1          bit flip = 0;
  45   1      
  46   1          ///////////////////////////////////////////
  47   1          UART_Init();
  48   1          // 初始化串口
  49   1      
  50   1      
  51   1          InitExternalInterrupt0();
  52   1      
  53   1          Relay1 = 0;
  54   1          Relay2 = 0;
C51 COMPILER V9.59.0.0   MAIN                                                              09/10/2025 18:24:03 PAGE 2   

  55   1          Relay3 = 0;
  56   1          RelayLED1 = 0;
  57   1          RelayLED2 = 0;
  58   1          RelayLED3 = 0;
  59   1          WarnLed = 0;
  60   1          BuzzerS1 = 0;
  61   1      
  62   1          //////////////////////////////////////////
  63   1      
  64   1          UART_SendString("51 Ready!\r\n");
  65   1      
  66   1          //////////////////////////////////////////
  67   1          while (1)
  68   1          {
  69   2              // timecount++;
  70   2              // if (timecount % 100 == 0)
  71   2              // {
  72   2              // }
  73   2      
  74   2              // UART_SendString("Hello, World!\r\n");
  75   2              if (getRec())
  76   2              {
  77   3      
  78   3              }
  79   2      
  80   2              if (getIRFlag())
  81   2              {
  82   3                  IRdata = getIRData();
  83   3      
  84   3                  // 发送标题
  85   3                  UART_SendString("IR Code: ");
  86   3      
  87   3                  // 逐个字节转换为16进制字符串发送
  88   3                  for (i = 0; i < 4; i++)
  89   3                  {
  90   4                      // 发送高4位
  91   4                      UART_SendChar((IRdata[i] >> 4) < 10 ? (IRdata[i] >> 4) + '0' : (IRdata[i] >> 4) + 'A' - 10
             -);
  92   4                      // 发送低4位
  93   4                      UART_SendChar((IRdata[i] & 0x0F) < 10 ? (IRdata[i] & 0x0F) + '0' : (IRdata[i] & 0x0F) + 'A
             -' - 10);
  94   4                      UART_SendChar(' ');
  95   4                  }
  96   3      
  97   3                  UART_SendString("\r\n"); // 换行
  98   3              }
  99   2      
 100   2              /*处理按钮调节*/
 101   2              if (SettingButton)
 102   2              {
 103   3                  settingflag = 1;
 104   3                  Timercount = 0;                   // 重置计时器
 105   3                  dateOrTempFlag = !dateOrTempFlag; // 直接翻转
 106   3                  dat.WarnFlag = 0;
 107   3              }
 108   2              // 警告状态
 109   2              if (dat.WarnFlag)
 110   2              {
 111   3                  WarnLed = 1;
 112   3                  BuzzerS1 = 1;
 113   3              }
 114   2              else
C51 COMPILER V9.59.0.0   MAIN                                                              09/10/2025 18:24:03 PAGE 3   

 115   2              {
 116   3                  WarnLed = 0;
 117   3                  BuzzerS1 = 0;
 118   3              }
 119   2      
 120   2              if (settingflag)
 121   2              {
 122   3                  // Delay_ms(1000); // 处于设置模式时延时
 123   3                  WarnLed = 1;
 124   3      
 125   3                  relaySetPos++;
 126   3                  if (relaySetPos >= 3)
 127   3                  {
 128   4                      relaySetPos = 1;
 129   4                  }
 130   3      
 131   3                  switch (relaySetPos)
 132   3                  {
 133   4                  case 1:
 134   4                      RelayLED1 = 1;
 135   4                      RelayLED2 = 0, RelayLED3 = 0;
 136   4                      break;
 137   4                  case 2:
 138   4                      RelayLED1 = 0;
 139   4                      RelayLED2 = 1, RelayLED3 = 0;
 140   4                      break;
 141   4                  case 3:
 142   4                      RelayLED1 = 0;
 143   4                      RelayLED2 = 0, RelayLED3 = 1;
 144   4                      break;
 145   4      
 146   4                  default:
 147   4                      break;
 148   4                  }
 149   3      
 150   3                  if (RelayButton == 1)
 151   3                  {
 152   4                      RelayBuzzer();
 153   4                      switch (relaySetPos)
 154   4                      {
 155   5                      case 1:
 156   5                          Relay1 = (Relay1 == 1 ? 0 : 1);
 157   5                          break;
 158   5                      case 2:
 159   5                          Relay2 = (Relay2 == 1 ? 0 : 1);
 160   5                          break;
 161   5                      case 3:
 162   5                          Relay3 = (Relay3 == 1 ? 0 : 1);
 163   5                          break;
 164   5      
 165   5                      default:
 166   5                          break;
 167   5                      }
 168   4                  }
 169   3      
 170   3                  // 十秒取消
 171   3                  if (Timercount >= 10)
 172   3                  {
 173   4                      settingflag = 0;
 174   4                      WarnLed = 0;
 175   4                  }
 176   3              }
C51 COMPILER V9.59.0.0   MAIN                                                              09/10/2025 18:24:03 PAGE 4   

 177   2      
 178   2              /*继电器灯光继承*/
 179   2              RelayLED1 = Relay1;
 180   2              RelayLED2 = Relay2;
 181   2              RelayLED3 = Relay3;
 182   2      
 183   2              // Delay_ms(10);
 184   2              // Delay_ms(150);
 185   2              Delay1000ms1();
 186   2          }
 187   1          //////////////////////////////////////////
 188   1      }
*** WARNING C280 IN LINE 34 OF main.c: 'msg': unreferenced local variable
*** WARNING C280 IN LINE 34 OF main.c: 'timestr': unreferenced local variable
*** WARNING C280 IN LINE 36 OF main.c: 'time': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    415    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =   ----      35
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       4
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
